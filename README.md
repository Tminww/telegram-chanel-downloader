# Telegram Channel Downloader

Этот проект представляет собой инструмент для скачивания сообщений и фотографий из Telegram-каналов с использованием библиотеки Telethon. Он сохраняет метаданные сообщений в JSON-файл и загружает только фото в указанную папку, игнорируя другие типы медиа (например, видео).

## Возможности

- Парсинг сообщений из Telegram-канала с сохранением текста, просмотров, пересылок, медиа и entities (упоминания, ссылки).
- Скачивание только фотографий из сообщений в папку с именем канала.
- Сохранение данных в структурированном JSON-файле.
- Поддержка конфигурации через файл `.env`.

## Требования

- Python 3.8+
- Установленный пакетный менеджер `uv` (альтернатива `pip`).
- Учётная запись Telegram и API-ключи (API_ID и API_HASH).

## Установка

1. **Клонируйте репозиторий:**

   ```bash
   git clone https://github.com/yourusername/telegram-channel-downloader.git
   cd telegram-channel-downloader
   ```

2. **Установите зависимости с помощью `uv`:**

   ```bash
   uv sync
   ```

3. **Создайте файл `.env` в корне проекта:**
   Пример `.env.example`:
   ```
   TELEGRAM_API_ID=1234567
   TELEGRAM_API_HASH=your_api_hash_here
   TELEGRAM_PHONE=+1234567890
   TELEGRAM_CHANNEL_USERNAME=123456789  # Числовой ID канала
   ```
   - `API_ID` и `API_HASH` можно получить на [my.telegram.org](https://my.telegram.org).
   - `PHONE` — ваш номер телефона в формате `+<код страны><номер>`.
   - `CHANNEL_USERNAME` — числовой ID канала (например, `1908514315` или `-1001908514315` для супергрупп).

## Использование

1. **Запустите скрипт:**

   ```bash
   uv run python src/main.py
   ```

   - При первом запуске потребуется ввести код подтверждения, отправленный Telegram на ваш номер телефона.
   - Скрипт начнёт скачивать сообщения и фото из указанного канала.

2. **Результаты:**

   - Сообщения сохраняются в `<BASE_PATH>/chats/<channel_name>/messages.json`.
   - Фото сохраняются в `<BASE_PATH>/chats/<channel_name>/media/<message_id>.jpg`.

3. **Прерывание:**
   - Нажмите `Ctrl+C`, чтобы остановить выполнение. Данные будут сохранены перед выходом.

## Структура проекта

```
telegram-channel-downloader/
├── src/
│   └── main.py         # Основной скрипт для парсинга и скачивания
├── config.py           # Конфигурация с использованием Pydantic
├── requirements.txt    # Зависимости проекта
├── .env                # Файл с переменными окружения (добавьте вручную)
└── README.md           # Этот файл
```

## Пример конфигурации

Файл `.env`:

```
TELEGRAM_API_ID=1234567
TELEGRAM_API_HASH=abcdef1234567890abcdef1234567890
TELEGRAM_PHONE=+1234567890
TELEGRAM_CHANNEL_USERNAME=1908514315
```

Запуск:

```bash
uv run python src/main.py
```

Вывод:

```
Найден канал: MyChannel
Скачано 10 сообщений...
Фото сохранено в: /path/to/base/chats/MyChannel/media/826.jpg
Сохранено 10 сообщений.
```

## Настройка

- **Лимит сообщений**: Измените `limit = 10` в `main.py` на нужное количество сообщений для скачивания за один запрос.
- **Путь сохранения**: Измените `BASE_PATH` в `config.py`, если хотите использовать другой каталог.

## Зависимости

- **Telethon**: Библиотека для работы с Telegram API.
- **Pydantic**: Валидация и управление настройками.
- **uv**: Пакетный менеджер для установки зависимостей.

Установите `uv`, если он ещё не установлен:

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

## Ограничения

- Скачиваются только фото (`MessageMediaPhoto`). Видео и другие медиа игнорируются.
- Требуется доступ к каналу (публичному или приватному, если вы участник).
- Числовой ID канала должен быть указан в `CHANNEL_USERNAME`.

## Устранение неполадок

- **Ошибка авторизации**: Проверьте `API_ID`, `API_HASH` и `PHONE` в `.env`.
- **Канал не найден**: Убедитесь, что `CHANNEL_USERNAME` — это числовой ID, а не имя с `@`.
- **Нет фото**: Проверьте, есть ли фото в сообщениях канала.
